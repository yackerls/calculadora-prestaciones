<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Liquidaci칩n GT - Exacta</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">

    <div class="max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-lg">
        <h1 class="text-2xl font-bold text-gray-800 mb-2 border-b pb-2">Calculadora Laboral Exacta 游섫릖</h1>
        <p class="text-sm text-gray-500 mb-6">C치lculo basado en d칤as calendario exactos (Regla: Salario Diario 칑 D칤as laborados en el per칤odo).</p>

        <div class="grid grid-cols-1 gap-4 mb-6">
            
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Salario Nominal (Q)</label>
                    <input type="number" id="salario" value="14000" class="mt-1 block w-full border border-gray-300 rounded-md p-2 shadow-sm focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Total Descuentos (IGSS/ISR/Otros)</label>
                    <input type="number" id="descuentos" value="1000" class="mt-1 block w-full border border-gray-300 rounded-md p-2">
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">Anticipo Quincena ya recibido (Q)</label>
                <input type="number" id="anticipo" value="4200" class="mt-1 block w-full border border-gray-300 rounded-md p-2 bg-yellow-50">
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">Motivo de salida</label>
                <select id="motivo" class="mt-1 block w-full border border-gray-300 rounded-md p-2">
                    <option value="despido">Despido Injustificado (Con Indemnizaci칩n)</option>
                    <option value="renuncia">Renuncia (Sin Indemnizaci칩n)</option>
                </select>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Fecha Inicio Labores</label>
                    <input type="date" id="fechaInicio" class="mt-1 block w-full border border-gray-300 rounded-md p-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Fecha Finalizaci칩n (칔ltimo d칤a)</label>
                    <input type="date" id="fechaFin" class="mt-1 block w-full border border-gray-300 rounded-md p-2">
                </div>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700">D칤as de vacaciones pendientes</label>
                <div class="flex gap-2">
                    <input type="number" id="diasVacaciones" value="15" step="0.01" class="mt-1 block w-full border border-gray-300 rounded-md p-2">
                    <button onclick="calcularProporcionalVacaciones()" class="mt-1 bg-gray-200 text-xs px-2 rounded hover:bg-gray-300" title="Calcula propocional del a침o actual">+ Proporcional A침o Actual</button>
                </div>
                <p class="text-xs text-gray-500 mt-1">Si ya cumpliste a침o y no has gozado, pon 15. Si quieres sumar el proporcional de enero, s칰male aprox 1.25 d칤as.</p>
            </div>

            <button onclick="calcular()" class="w-full bg-blue-700 text-white font-bold py-3 px-4 rounded hover:bg-blue-800 transition duration-200 shadow-md">
                CALCULAR EXACTO
            </button>
        </div>

        <div id="resultados" class="hidden bg-gray-50 p-4 rounded-lg border border-gray-200">
            <h3 class="text-lg font-semibold mb-3">Prestaciones Laborales</h3>
            
            <div class="space-y-2 text-sm">
                <div class="flex justify-between border-b pb-1">
                    <span>Indemnizaci칩n (Tiempo de Servicio):</span>
                    <span id="resIndemnizacion" class="font-mono font-bold">Q0.00</span>
                </div>
                <div class="flex justify-between border-b pb-1">
                    <span>Bono 14 (Proporcional): <span id="diasBono" class="text-xs text-gray-500"></span></span>
                    <span id="resBono14" class="font-mono">Q0.00</span>
                </div>
                <div class="flex justify-between border-b pb-1">
                    <span>Aguinaldo (Proporcional): <span id="diasAguinaldo" class="text-xs text-gray-500"></span></span>
                    <span id="resAguinaldo" class="font-mono">Q0.00</span>
                </div>
                <div class="flex justify-between border-b pb-1">
                    <span>Vacaciones:</span>
                    <span id="resVacaciones" class="font-mono">Q0.00</span>
                </div>
                <div class="flex justify-between pt-2 text-blue-800 font-bold text-lg">
                    <span>TOTAL LIQUIDACI칍N:</span>
                    <span id="totalPrestaciones">Q0.00</span>
                </div>
            </div>

            <h3 class="text-lg font-semibold mt-6 mb-3">Sueldo Pendiente (Neto)</h3>
            <div class="space-y-2 text-sm">
                 <div class="flex justify-between">
                    <span>Sueldo Bruto Mes:</span>
                    <span id="resSueldoBruto" class="font-mono">Q0.00</span>
                </div>
                <div class="flex justify-between text-red-600">
                    <span>(-) Descuentos:</span>
                    <span id="resDescuentos" class="font-mono">-Q0.00</span>
                </div>
                 <div class="flex justify-between text-red-600 border-b pb-1">
                    <span>(-) Anticipo:</span>
                    <span id="resAnticipo" class="font-mono">-Q0.00</span>
                </div>
                 <div class="flex justify-between pt-2 text-green-700 font-bold">
                    <span>A RECIBIR DE SUELDO:</span>
                    <span id="totalSueldo">Q0.00</span>
                </div>
            </div>

            <div class="mt-6 p-4 bg-green-100 rounded text-center border border-green-300 shadow-inner">
                <span class="block text-gray-600 text-sm font-semibold">TOTAL FINAL A RECIBIR</span>
                <span id="granTotal" class="text-4xl font-bold text-green-800">Q0.00</span>
            </div>
        </div>
    </div>

    <script>
        // Set defaults
        const today = new Date();
        const startOfYear = new Date(today.getFullYear()-1, 0, 1);
        // Formato YYYY-MM-DD para inputs date
        document.getElementById('fechaInicio').valueAsDate = startOfYear; 
        document.getElementById('fechaFin').valueAsDate = today;

        function calcular() {
            const salario = parseFloat(document.getElementById('salario').value) || 0;
            const descuentos = parseFloat(document.getElementById('descuentos').value) || 0;
            const anticipo = parseFloat(document.getElementById('anticipo').value) || 0;
            const diasVacaciones = parseFloat(document.getElementById('diasVacaciones').value) || 0;
            const motivo = document.getElementById('motivo').value;
            
            // Fechas en UTC para evitar problemas de zona horaria
            const fInicio = new Date(document.getElementById('fechaInicio').value);
            const fFin = new Date(document.getElementById('fechaFin').value);
            
            // Ajustar a medio d칤a para evitar saltos de fecha por timezone
            fInicio.setHours(12,0,0,0);
            fFin.setHours(12,0,0,0);

            // C치lculos base
            const unDia = 1000 * 60 * 60 * 24;
            const antiguedadDias = Math.floor((fFin - fInicio) / unDia) + 1; // +1 inclusivo
            const salarioDiario = salario / 30; // Base comercial mensual
            const salarioDiarioAnual = salario / 365; // Base para prestaciones anuales exactas

            // 1. INDEMNIZACION
            // Base: (Salario + 1/6) seg칰n c칩digo de trabajo para incluir promedio aguinaldo/bono
            // O la regla comercial: (Salario * 14) / 12
            let indemnizacion = 0;
            if (motivo === 'despido') {
                const baseIndem = (salario * 14) / 12; // Base Promedio
                const anios = antiguedadDias / 365; // A침os exactos
                indemnizacion = baseIndem * anios;
            }

            // 2. BONO 14 (Periodo: 1 Julio - 30 Junio)
            // Encontrar el 1 de julio anterior a la fecha de fin
            let inicioBono = new Date(fFin.getFullYear(), 6, 1); // 1 Julio de este a침o
            if (fFin < inicioBono) {
                inicioBono = new Date(fFin.getFullYear() - 1, 6, 1); // 1 Julio del a침o pasado
            }
            // Si la fecha de inicio laboral es posterior al inicio del periodo bono, usar fecha inicio
            let fechaArrancaBono = (fInicio > inicioBono) ? fInicio : inicioBono;
            
            const diasBono = Math.max(0, Math.floor((fFin - fechaArrancaBono) / unDia) + 1);
            // F칩rmula exacta: (Salario / 365) * D칤as trabajados en el periodo
            // Nota: Se suele usar Salario Promedio, aqu칤 usaremos el nominal actual
            const bono14 = (salario / 365) * diasBono; 

            // 3. AGUINALDO (Periodo: 1 Diciembre - 30 Noviembre)
            let inicioAguinaldo = new Date(fFin.getFullYear(), 11, 1); // 1 Dic este a침o
            if (fFin < inicioAguinaldo) {
                inicioAguinaldo = new Date(fFin.getFullYear() - 1, 11, 1); // 1 Dic a침o pasado
            }
            let fechaArrancaAguinaldo = (fInicio > inicioAguinaldo) ? fInicio : inicioAguinaldo;

            const diasAguinaldo = Math.max(0, Math.floor((fFin - fechaArrancaAguinaldo) / unDia) + 1);
            const aguinaldo = (salario / 365) * diasAguinaldo;

            // 4. VACACIONES
            const pagoVacaciones = salarioDiario * diasVacaciones;

            // Totales
            const totalPrestaciones = indemnizacion + bono14 + aguinaldo + pagoVacaciones;
            const sueldoLiquido = salario - descuentos;
            const restanteSueldo = sueldoLiquido - anticipo;
            const granTotal = totalPrestaciones + restanteSueldo;

            // Render
            document.getElementById('resIndemnizacion').innerText = formatearQ(indemnizacion);
            
            document.getElementById('resBono14').innerText = formatearQ(bono14);
            document.getElementById('diasBono').innerText = `(${diasBono} d칤as calc)`;
            
            document.getElementById('resAguinaldo').innerText = formatearQ(aguinaldo);
            document.getElementById('diasAguinaldo').innerText = `(${diasAguinaldo} d칤as calc)`;
            
            document.getElementById('resVacaciones').innerText = formatearQ(pagoVacaciones);
            document.getElementById('totalPrestaciones').innerText = formatearQ(totalPrestaciones);

            document.getElementById('resSueldoBruto').innerText = formatearQ(salario);
            document.getElementById('resDescuentos').innerText = '-' + formatearQ(descuentos);
            document.getElementById('resAnticipo').innerText = '-' + formatearQ(anticipo);
            document.getElementById('totalSueldo').innerText = formatearQ(restanteSueldo);
            document.getElementById('granTotal').innerText = formatearQ(granTotal);
            
            document.getElementById('resultados').classList.remove('hidden');
        }

        function calcularProporcionalVacaciones() {
            // L칩gica simple: Sumar proporcional desde el 칰ltimo aniversario hasta Fecha Fin
            const fInicio = new Date(document.getElementById('fechaInicio').value);
            const fFin = new Date(document.getElementById('fechaFin').value);
            
            // Encontrar el 칰ltimo aniversario
            let ultimoAniversario = new Date(fInicio);
            ultimoAniversario.setFullYear(fFin.getFullYear());
            if (ultimoAniversario > fFin) {
                ultimoAniversario.setFullYear(fFin.getFullYear() - 1);
            }

            const unDia = 1000 * 60 * 60 * 24;
            const diasDesdeAniversario = Math.floor((fFin - ultimoAniversario) / unDia);
            
            // 15 d칤as por cada 365 d칤as
            const proporcional = (diasDesdeAniversario * 15) / 365;
            
            // Sumar al input actual
            let actual = parseFloat(document.getElementById('diasVacaciones').value) || 0;
            document.getElementById('diasVacaciones').value = (actual + proporcional).toFixed(2);
            alert(`Se agregaron ${proporcional.toFixed(2)} d칤as proporcionales.`);
            calcular();
        }

        function formatearQ(monto) {
            return 'Q' + monto.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
        }
    </script>
</body>
</html>