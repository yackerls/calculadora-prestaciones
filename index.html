<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Laboral GT - Detallada</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4 md:p-8">

    <div class="max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-lg">
        <h1 class="text-2xl font-bold text-gray-800 mb-2 border-b pb-2">Calculadora Laboral Exacta 游섫릖</h1>
        <p class="text-sm text-gray-500 mb-6">C치lculo detallado de prestaciones y desglose de sueldo l칤quido.</p>

        <div class="grid grid-cols-1 gap-5 mb-6">
            
            <div>
                <label class="block text-sm font-medium text-gray-700">Salario Nominal Mensual (Q)</label>
                <input type="number" id="salario" value="14000" oninput="actualizarIGSS()" class="mt-1 block w-full border border-gray-300 rounded-md p-2 shadow-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 font-bold text-gray-800">
            </div>

            <div class="bg-gray-50 p-4 rounded-md border border-gray-200">
                <label class="block text-sm font-medium text-gray-800 mb-2 border-b border-gray-300 pb-1">Desglose de Descuentos</label>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                    <div>
                        <label class="block text-xs text-gray-500">IGSS (4.83% aprox)</label>
                        <input type="number" id="descIGSS" placeholder="0.00" class="mt-1 block w-full border border-gray-300 rounded-md p-2 text-sm">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500">ISR (Impuesto)</label>
                        <input type="number" id="descISR" placeholder="0.00" class="mt-1 block w-full border border-gray-300 rounded-md p-2 text-sm">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500">Otros (Parqueo/Comida)</label>
                        <input type="number" id="descOtros" placeholder="0.00" class="mt-1 block w-full border border-gray-300 rounded-md p-2 text-sm">
                    </div>
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">Anticipo Quincena ya recibido (Q)</label>
                <input type="number" id="anticipo" value="4200" class="mt-1 block w-full border border-gray-300 rounded-md p-2 bg-yellow-50">
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">Motivo de salida</label>
                <select id="motivo" class="mt-1 block w-full border border-gray-300 rounded-md p-2">
                    <option value="despido">Despido Injustificado (Con Indemnizaci칩n)</option>
                    <option value="renuncia">Renuncia (Sin Indemnizaci칩n)</option>
                </select>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Fecha Inicio Labores</label>
                    <input type="date" id="fechaInicio" class="mt-1 block w-full border border-gray-300 rounded-md p-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Fecha Salida</label>
                    <input type="date" id="fechaFin" class="mt-1 block w-full border border-gray-300 rounded-md p-2">
                </div>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700">D칤as de vacaciones pendientes</label>
                <div class="flex gap-2">
                    <input type="number" id="diasVacaciones" value="15" step="0.01" class="mt-1 block w-full border border-gray-300 rounded-md p-2">
                    <button onclick="calcularProporcionalVacaciones()" class="mt-1 bg-gray-200 text-xs px-2 rounded hover:bg-gray-300 text-gray-600 border border-gray-300 whitespace-nowrap">Calc. Proporcional</button>
                </div>
            </div>

            <button onclick="calcular()" class="w-full bg-blue-700 text-white font-bold py-3 px-4 rounded hover:bg-blue-800 transition duration-200 shadow-md">
                CALCULAR LIQUIDACI칍N
            </button>
        </div>

        <div id="resultados" class="hidden bg-gray-50 p-4 rounded-lg border border-gray-200">
            <h3 class="text-lg font-semibold mb-3 border-b border-gray-300 pb-1">1. Prestaciones (Liquidaci칩n)</h3>
            
            <div class="space-y-2 text-sm mb-6">
                <div class="flex justify-between border-b border-gray-200 pb-1 border-dotted">
                    <span class="text-gray-600">Indemnizaci칩n (Tiempo):</span>
                    <span id="resIndemnizacion" class="font-mono font-bold text-gray-800">Q0.00</span>
                </div>
                <div class="flex justify-between border-b border-gray-200 pb-1 border-dotted">
                    <span class="text-gray-600">Bono 14 (Proporcional): <span id="diasBono" class="text-xs text-gray-400"></span></span>
                    <span id="resBono14" class="font-mono text-gray-800">Q0.00</span>
                </div>
                <div class="flex justify-between border-b border-gray-200 pb-1 border-dotted">
                    <span class="text-gray-600">Aguinaldo (Proporcional): <span id="diasAguinaldo" class="text-xs text-gray-400"></span></span>
                    <span id="resAguinaldo" class="font-mono text-gray-800">Q0.00</span>
                </div>
                <div class="flex justify-between border-b border-gray-200 pb-1 border-dotted">
                    <span class="text-gray-600">Vacaciones Pendientes:</span>
                    <span id="resVacaciones" class="font-mono text-gray-800">Q0.00</span>
                </div>
                <div class="flex justify-between pt-2 text-blue-800 font-bold">
                    <span>SUBTOTAL PRESTACIONES:</span>
                    <span id="totalPrestaciones">Q0.00</span>
                </div>
            </div>

            <h3 class="text-lg font-semibold mb-3 border-b border-gray-300 pb-1">2. Sueldo del Mes (Neto)</h3>
            <div class="space-y-2 text-sm">
                 <div class="flex justify-between font-medium">
                    <span>Sueldo Bruto Mes:</span>
                    <span id="resSueldoBruto" class="font-mono">Q0.00</span>
                </div>
                
                <div class="pl-4 border-l-2 border-red-200 my-2 space-y-1">
                    <div class="flex justify-between text-red-600 text-xs">
                        <span>(-) IGSS:</span>
                        <span id="resDescIGSS" class="font-mono">-Q0.00</span>
                    </div>
                    <div class="flex justify-between text-red-600 text-xs">
                        <span>(-) ISR:</span>
                        <span id="resDescISR" class="font-mono">-Q0.00</span>
                    </div>
                    <div class="flex justify-between text-red-600 text-xs">
                        <span>(-) Otros (Comida/Parqueo):</span>
                        <span id="resDescOtros" class="font-mono">-Q0.00</span>
                    </div>
                </div>

                 <div class="flex justify-between text-red-700 font-medium border-b border-gray-300 pb-2">
                    <span>(-) Anticipo Quincena:</span>
                    <span id="resAnticipo" class="font-mono">-Q0.00</span>
                </div>
                 <div class="flex justify-between pt-2 text-green-700 font-bold text-lg">
                    <span>RESTANTE SUELDO:</span>
                    <span id="totalSueldo">Q0.00</span>
                </div>
            </div>

            <div class="mt-6 p-4 bg-green-100 rounded text-center border border-green-300 shadow-sm">
                <span class="block text-gray-600 text-sm font-semibold uppercase tracking-wide">Total Final a Recibir</span>
                <span id="granTotal" class="text-4xl font-bold text-green-800">Q0.00</span>
                <p class="text-xs text-green-700 mt-1">(Prestaciones + Sueldo Restante)</p>
            </div>
        </div>
    </div>

    <script>
        // Configuraci칩n inicial de fechas y valores
        const today = new Date();
        const startOfYear = new Date(today.getFullYear()-1, 0, 1);
        
        document.getElementById('fechaInicio').valueAsDate = startOfYear; 
        document.getElementById('fechaFin').valueAsDate = today;

        // Auto-calcular IGSS inicial
        actualizarIGSS();

        function actualizarIGSS() {
            // Si el usuario no ha tocado manual, calculamos el 4.83%
            const salario = parseFloat(document.getElementById('salario').value) || 0;
            const igssEstimado = salario * 0.0483;
            // Solo sugerimos valor si el campo est치 vac칤o o es el valor por defecto anterior
            const inputIGSS = document.getElementById('descIGSS');
            if (inputIGSS.value === "" || inputIGSS.dataset.auto === "true") {
                inputIGSS.value = igssEstimado.toFixed(2);
                inputIGSS.dataset.auto = "true"; // Marca para saber que fue auto-calculado
            }
        }
        
        // Si el usuario escribe manualmente en IGSS, quitamos la marca de "auto"
        document.getElementById('descIGSS').addEventListener('input', function() {
            this.dataset.auto = "false";
        });

        function calcular() {
            // Inputs
            const salario = parseFloat(document.getElementById('salario').value) || 0;
            const anticipo = parseFloat(document.getElementById('anticipo').value) || 0;
            const diasVacaciones = parseFloat(document.getElementById('diasVacaciones').value) || 0;
            const motivo = document.getElementById('motivo').value;

            // Descuentos desglosados
            const valIGSS = parseFloat(document.getElementById('descIGSS').value) || 0;
            const valISR = parseFloat(document.getElementById('descISR').value) || 0;
            const valOtros = parseFloat(document.getElementById('descOtros').value) || 0;
            const totalDescuentos = valIGSS + valISR + valOtros;
            
            // Fechas
            const fInicio = new Date(document.getElementById('fechaInicio').value);
            const fFin = new Date(document.getElementById('fechaFin').value);
            fInicio.setHours(12,0,0,0);
            fFin.setHours(12,0,0,0);

            // C치lculos de tiempo
            const unDia = 1000 * 60 * 60 * 24;
            const antiguedadDias = Math.floor((fFin - fInicio) / unDia) + 1;
            const salarioDiario = salario / 30;

            // 1. INDEMNIZACION
            let indemnizacion = 0;
            if (motivo === 'despido') {
                const baseIndem = (salario * 14) / 12; 
                const anios = antiguedadDias / 365; 
                indemnizacion = baseIndem * anios;
            }

            // 2. BONO 14 (1 Julio - 30 Junio)
            let inicioBono = new Date(fFin.getFullYear(), 6, 1); 
            if (fFin < inicioBono) inicioBono = new Date(fFin.getFullYear() - 1, 6, 1);
            let fechaArrancaBono = (fInicio > inicioBono) ? fInicio : inicioBono;
            const diasBono = Math.max(0, Math.floor((fFin - fechaArrancaBono) / unDia) + 1);
            const bono14 = (salario / 365) * diasBono; 

            // 3. AGUINALDO (1 Dic - 30 Nov)
            let inicioAguinaldo = new Date(fFin.getFullYear(), 11, 1); 
            if (fFin < inicioAguinaldo) inicioAguinaldo = new Date(fFin.getFullYear() - 1, 11, 1);
            let fechaArrancaAguinaldo = (fInicio > inicioAguinaldo) ? fInicio : inicioAguinaldo;
            const diasAguinaldo = Math.max(0, Math.floor((fFin - fechaArrancaAguinaldo) / unDia) + 1);
            const aguinaldo = (salario / 365) * diasAguinaldo;

            // 4. VACACIONES
            const pagoVacaciones = salarioDiario * diasVacaciones;

            // TOTALES
            const totalPrestaciones = indemnizacion + bono14 + aguinaldo + pagoVacaciones;
            const sueldoLiquido = salario - totalDescuentos;
            const restanteSueldo = sueldoLiquido - anticipo;
            const granTotal = totalPrestaciones + restanteSueldo;

            // RENDERIZADO EN PANTALLA
            
            // Prestaciones
            document.getElementById('resIndemnizacion').innerText = formatearQ(indemnizacion);
            document.getElementById('resBono14').innerText = formatearQ(bono14);
            document.getElementById('diasBono').innerText = `(${diasBono} d칤as)`;
            document.getElementById('resAguinaldo').innerText = formatearQ(aguinaldo);
            document.getElementById('diasAguinaldo').innerText = `(${diasAguinaldo} d칤as)`;
            document.getElementById('resVacaciones').innerText = formatearQ(pagoVacaciones);
            document.getElementById('totalPrestaciones').innerText = formatearQ(totalPrestaciones);

            // Sueldo y Desglose
            document.getElementById('resSueldoBruto').innerText = formatearQ(salario);
            
            // Descuentos individuales
            document.getElementById('resDescIGSS').innerText = '-' + formatearQ(valIGSS);
            document.getElementById('resDescISR').innerText = '-' + formatearQ(valISR);
            document.getElementById('resDescOtros').innerText = '-' + formatearQ(valOtros);
            
            document.getElementById('resAnticipo').innerText = '-' + formatearQ(anticipo);
            document.getElementById('totalSueldo').innerText = formatearQ(restanteSueldo);
            document.getElementById('granTotal').innerText = formatearQ(granTotal);
            
            document.getElementById('resultados').classList.remove('hidden');
        }

        function calcularProporcionalVacaciones() {
            const fInicio = new Date(document.getElementById('fechaInicio').value);
            const fFin = new Date(document.getElementById('fechaFin').value);
            
            let ultimoAniversario = new Date(fInicio);
            ultimoAniversario.setFullYear(fFin.getFullYear());
            if (ultimoAniversario > fFin) {
                ultimoAniversario.setFullYear(fFin.getFullYear() - 1);
            }
            const unDia = 1000 * 60 * 60 * 24;
            const diasDesdeAniversario = Math.floor((fFin - ultimoAniversario) / unDia);
            const proporcional = (diasDesdeAniversario * 15) / 365;
            
            let actual = parseFloat(document.getElementById('diasVacaciones').value) || 0;
            document.getElementById('diasVacaciones').value = (actual + proporcional).toFixed(2);
            calcular();
        }

        function formatearQ(monto) {
            return 'Q' + monto.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
        }
    </script>
</body>
</html>